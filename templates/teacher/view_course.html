{% extends "teacher/base_teacher.html" %}
{% block content %}
<h2>{{ course.course_name }}</h2>
<p>Duration: {{ course.course_duration }} hours</p>
<p>Price: ${{ course.course_price }}</p>
<p>Total Enrollments: {{ course.total_enrollments }}</p>
<p>Total Revenue: ${{ course.total_revenue }}</p>
<p>Average Rating: {{ course.average_rating|round(2) }} ({{ course.total_ratings }} ratings)</p>

<h3>Videos:</h3>
<ul id="video-list" class="list-group">
{% for video_id, video in course.sorted_videos.items() %}
    <li class="list-group-item" data-id="{{ video_id }}">
        <span class="handle">â˜°</span>
        {{ video.title }} ({{ video.duration }} minutes)
        <a href="{{ video.url }}" target="_blank" class="btn btn-sm btn-info">Watch</a>
        <a href="{{ url_for('teacher.edit_video', course_id=course.id, video_id=video_id) }}" class="btn btn-sm btn-primary">Edit</a>
        <a href="{{ url_for('teacher.delete_video', course_id=course.id, video_id=video_id) }}" onclick="return confirm('Are you sure you want to delete this video?');" class="btn btn-sm btn-danger">Delete</a>
    </li>
{% endfor %}
</ul>

<form id="reorder-form" method="POST" action="{{ url_for('teacher.reorder_videos', course_id=course.id) }}">
    <input type="hidden" name="video_order" id="video-order">
    <button type="submit" class="btn btn-primary mt-3">Save Video Order</button>
</form>

<a href="{{ url_for('teacher.add_video', course_id=course.id) }}" class="btn btn-success mt-3">Add New Video</a>
<a href="{{ url_for('teacher.edit_course', course_id=course.id) }}" class="btn btn-secondary mt-3">Edit Course</a>
<a href="{{ url_for('teacher.dashboard') }}" class="btn btn-link mt-3">Back to Dashboard</a>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Sortable/1.14.0/Sortable.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    var el = document.getElementById('video-list');
    var sortable = Sortable.create(el, {
        handle: '.handle',
        animation: 150,
    });

    document.getElementById('reorder-form').addEventListener('submit', function(e) {
        var videoOrder = sortable.toArray();
        document.getElementById('video-order').value = videoOrder.join(',');
    });
});
</script>
{% endblock %}